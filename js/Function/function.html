<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1、箭头函数 p288 | Sans_</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="stay hungry，stay foolish">
    
    <link rel="preload" href="/assets/css/0.styles.f81279c5.css" as="style"><link rel="preload" href="/assets/js/app.c68e1700.js" as="script"><link rel="preload" href="/assets/js/3.957d5f92.js" as="script"><link rel="preload" href="/assets/js/1.1e92a90c.js" as="script"><link rel="preload" href="/assets/js/25.6e52175e.js" as="script"><link rel="prefetch" href="/assets/js/10.41b2bf91.js"><link rel="prefetch" href="/assets/js/11.eee2a19d.js"><link rel="prefetch" href="/assets/js/12.13154a0a.js"><link rel="prefetch" href="/assets/js/13.b9df14aa.js"><link rel="prefetch" href="/assets/js/14.4da73ee6.js"><link rel="prefetch" href="/assets/js/15.c603e9dc.js"><link rel="prefetch" href="/assets/js/16.7a8c63fb.js"><link rel="prefetch" href="/assets/js/17.16162e73.js"><link rel="prefetch" href="/assets/js/18.9bca3ebd.js"><link rel="prefetch" href="/assets/js/19.01ac5bc4.js"><link rel="prefetch" href="/assets/js/20.065b5032.js"><link rel="prefetch" href="/assets/js/21.b5bb0d31.js"><link rel="prefetch" href="/assets/js/22.04aa70df.js"><link rel="prefetch" href="/assets/js/23.1adba5e7.js"><link rel="prefetch" href="/assets/js/24.a507a6d1.js"><link rel="prefetch" href="/assets/js/26.18c3dc99.js"><link rel="prefetch" href="/assets/js/27.9aa6797e.js"><link rel="prefetch" href="/assets/js/28.d44ef097.js"><link rel="prefetch" href="/assets/js/29.cf89fe09.js"><link rel="prefetch" href="/assets/js/30.35a9b9d1.js"><link rel="prefetch" href="/assets/js/31.32d68f06.js"><link rel="prefetch" href="/assets/js/32.49593b8a.js"><link rel="prefetch" href="/assets/js/33.743ce33e.js"><link rel="prefetch" href="/assets/js/34.29b25dcb.js"><link rel="prefetch" href="/assets/js/35.309181ea.js"><link rel="prefetch" href="/assets/js/36.24b74c86.js"><link rel="prefetch" href="/assets/js/37.e5a471e3.js"><link rel="prefetch" href="/assets/js/38.3f72950b.js"><link rel="prefetch" href="/assets/js/39.f03c4c47.js"><link rel="prefetch" href="/assets/js/4.0968ad41.js"><link rel="prefetch" href="/assets/js/40.cc9c0bb0.js"><link rel="prefetch" href="/assets/js/41.ebf9fe22.js"><link rel="prefetch" href="/assets/js/42.a37eaa07.js"><link rel="prefetch" href="/assets/js/5.ed348d91.js"><link rel="prefetch" href="/assets/js/6.cf81965e.js"><link rel="prefetch" href="/assets/js/7.97cb5f84.js"><link rel="prefetch" href="/assets/js/8.beddb4e4.js"><link rel="prefetch" href="/assets/js/9.54372a49.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f81279c5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Sans_</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>stay hungry，stay foolish</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>sans</span>
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Sans_</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/CSS/" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/categories/日常/" class="nav-link"><i class="undefined"></i>
  日常
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具/" class="nav-link"><i class="undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/数组/" class="nav-link"><i class="undefined"></i>
  数组
</a></li><li class="dropdown-item"><!----> <a href="/categories/服务器/" class="nav-link"><i class="undefined"></i>
  服务器
</a></li><li class="dropdown-item"><!----> <a href="/categories/心得/" class="nav-link"><i class="undefined"></i>
  心得
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/experience/utils.html" class="nav-link"><i class="undefined"></i>
  心得
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link router-link-active"><i class="undefined"></i>
  JS
</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link"><i class="undefined"></i>
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/vue/experience/keepAlive.html" class="nav-link"><i class="undefined"></i>
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="/js/about.html" class="nav-link"><i class="undefined"></i>
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <h3 class="name" data-v-39576ba9>
    sans
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>29</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>14</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/CSS/" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/categories/日常/" class="nav-link"><i class="undefined"></i>
  日常
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具/" class="nav-link"><i class="undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/数组/" class="nav-link"><i class="undefined"></i>
  数组
</a></li><li class="dropdown-item"><!----> <a href="/categories/服务器/" class="nav-link"><i class="undefined"></i>
  服务器
</a></li><li class="dropdown-item"><!----> <a href="/categories/心得/" class="nav-link"><i class="undefined"></i>
  心得
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/experience/utils.html" class="nav-link"><i class="undefined"></i>
  心得
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link router-link-active"><i class="undefined"></i>
  JS
</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link"><i class="undefined"></i>
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/vue/experience/keepAlive.html" class="nav-link"><i class="undefined"></i>
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="/js/about.html" class="nav-link"><i class="undefined"></i>
  关于
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>函数</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/Function/" aria-current="page" class="sidebar-link">函数</a></li><li><a href="/js/Function/function.html" aria-current="page" class="active sidebar-link">1、箭头函数 p288</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>期约与异步函数</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>sans</span>
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">1、箭头函数 p288</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>sans</span></i> <!----> <i class="iconfont reco-eye" data-v-f875f3fc><span id="/js/Function/function.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f875f3fc><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="_1、箭头函数-p288"><a href="#_1、箭头函数-p288" class="header-anchor">#</a> 1、箭头函数 p288</h2> <p>如果只有一个参数，可以不用括号。没有参数或多个参数才需要使用括号：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 以下两种方法都有效</span>
<span class="token keyword">let</span> <span class="token function-variable function">double</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> x<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">triple</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">3</span> <span class="token operator">*</span> x<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 没有参数时需要括号</span>
<span class="token keyword">let</span> <span class="token function-variable function">getRandom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token comment">// 多个参数需要括号</span>
<span class="token keyword">let</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 无效的写法</span>
<span class="token keyword">let</span> mutiply <span class="token operator">=</span> a<span class="token punctuation">,</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>箭头函数的大括号说明包含<strong>函数体</strong> ，可以在一<strong>个函数中包含多条语句</strong>。如果不使用大括号，箭头后面的就只能<strong>是一行代码</strong>，比如一个<strong>赋值操作</strong>或者<strong>表达式</strong>。而且省略大括号会<strong>隐式的返回</strong>这行代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 以下两种方式都有效而且会返回相应的值</span>
<span class="token keyword">let</span> <span class="token function-variable function">double</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 箭头函数省略大括号会隐式的返回值</span>
<span class="token keyword">let</span> <span class="token function-variable function">triple</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">// 进行赋值</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">setName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Sans'</span><span class="token punctuation">;</span>
<span class="token function">setName</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sans</span>
<span class="token comment">//无效的写法</span>
<span class="token keyword">let</span> <span class="token function-variable function">mutiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b
</code></pre></div><div class="custom-block tip"><p class="title"></p><p>箭头函数不能使用<code>arguments</code>，<code>super</code>和<code>new.target</code>,也不能用作构造函数。此外箭头函数也没有<code>prototype</code>属性。</p></div><h2 id="_2、函数名"><a href="#_2、函数名" class="header-anchor">#</a> 2、函数名</h2> <p><mark>函数名就是指向函数的指针</mark></p> <p><code>ECMAScript6</code>的<strong>所有函数对象都会暴露</strong>一个只读<code>name</code>属性，保存的是函数标识符</p> <p>即使函数没有名称也会显示成空字符串，如果使用<code>Function</code>构造函数，则会标识成“anonymous”</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 函数标识符 name</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">baz</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// foo</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// bar</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baz<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// baz</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ''</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// anonymous</span>
</code></pre></div><p>函数如果是一个获取函数、设置函数、或者使用<code>bind()</code>实例化，那么标识符就会加上前缀</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 函数前缀 给设置函数 获取函数或者通过 bind实例化的函数会带有前缀</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  bound foo </span>
<span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">years</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>years
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token parameter">newAge</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>years <span class="token operator">=</span> newAge
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> propertyDescriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>dog<span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 相当于直接遍历调用上述方法</span>
<span class="token keyword">let</span> propertyDescriptors <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>propertyDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>propertyDescriptors<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>propertyDescriptor<span class="token punctuation">.</span>get<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// get age</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>propertyDescriptor<span class="token punctuation">.</span>set<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// set age</span>
</code></pre></div><h2 id="_3、理解参数-p-290"><a href="#_3、理解参数-p-290" class="header-anchor">#</a> 3、理解参数 p 290</h2> <p>在使用<code>function</code>关键词定义(<strong>非箭头函数</strong>)函数时，能够通过访问函数内的<code>arguments</code>对象，从中取得每个传入的参数。</p> <p><strong><code>arguments</code>对象是一个类数组对象（并不是<code>Array</code>的实例）</strong>。可以通过<code>arguments.length</code>判断传入多少个参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">howManyArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token function">howManyArgs</span><span class="token punctuation">(</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 </span>
<span class="token function">howManyArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 </span>
<span class="token function">howManyArgs</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 </span>
</code></pre></div><p><mark><code>arguments</code>可以跟命名参数一起使用</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doAdd</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num1 <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre></div><p><mark>在<code>arguments</code>中，它的值始终会与对应的命名参数同步</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// arguments的值始终与对应的命名参数同步</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// 40 </span>
</code></pre></div><p><code>arguments</code>的值会<strong>自动同步</strong>到对应的<strong>命令参数</strong>，但是其<strong>内存地址</strong>是分开的，仅仅只是<strong>保持同步</strong>了而已。</p> <div class="custom-block tip"><p class="title"></p><p><code>arguments</code>对象的长度是根据传入的参数的个数，而不是定义函数时给出的命令参数的个数决定的。</p></div><div class="custom-block warning"><p class="title"></p><p>在严格模式下，将<code>arguments[1]</code>赋值不会影响<code>num2</code>的值。其次，在函数中重写<code>arguments</code>对象也会导致语法错误</p></div><h3 id="箭头函数中的参数"><a href="#箭头函数中的参数" class="header-anchor">#</a> 箭头函数中的参数</h3> <p><mark>在箭头函数中只能够通过命名参数进行访问，不能使用<code>arguments</code>关键词</mark></p> <p><mark>在箭头函数中没有<code>arguments</code>对象，但是可以将其包装在函数中，提供给箭头函数</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将arguments对象包装在函数中然后传递给箭头函数</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">let</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
</code></pre></div><div class="custom-block tip"><p class="title"></p><p><code>ECMAScript</code>中所有<strong>参数的传递</strong>都是<strong>按值传递</strong>的，<strong>不能</strong>按<strong>引用</strong>传递参数。如果将对象作为参数传递，那么传递的就是这个参数的引用。</p></div><h2 id="_4、没有重载-p92"><a href="#_4、没有重载-p92" class="header-anchor">#</a> 4、没有重载 p92</h2> <p><strong>什么是重载？</strong></p> <p>重载就是一个函数可以有两个定义，只要签名（接受参数的类型和数量）不同就行。</p> <p><code>ECMAScript</code>中是<strong>没有重载</strong>这个概念的，因为<strong>参数</strong>是<strong>由零个或多个值</strong>得<strong>数组</strong>表示的。<strong>没有函数签名</strong>，自然没有重载。</p> <div class="custom-block tip"><p class="title"></p><ol><li><p>如果在<code>ECMAScript</code>中定义两个同名的函数，则后定义的会覆盖先定义的；</p></li> <li><p>可以通过<strong>检查参数的类型和数量</strong>，然后分别<strong>执行不同的逻辑</strong>来<strong>模拟</strong>函数重载；</p></li> <li><p>将函数名当做指针有助于理解为什么<code>ECMAScript</code>没有函数重载，因为其会被后定义的覆盖</p></li></ol></div><h2 id="_5、默认参数值"><a href="#_5、默认参数值" class="header-anchor">#</a> 5、默认参数值</h2> <p>在<code>ECMAScript5.1</code>以前，怎样实现默认参数的？</p> <p>答：通过检查某个参数是否等于<code>undefined</code>,如果是则意味着没有传递参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ECMA5.1之前设置默认参数</span>
<span class="token keyword">function</span> <span class="token function">making</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token operator">?</span> name <span class="token operator">:</span> <span class="token string">'Henry'</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> VIII</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">making</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//  King Henry VIII</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">making</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// King Louis VIII</span>
</code></pre></div><p>在<code>ES6</code>中，只要在函数定义中的参数后面用 <code>=</code>就可以为参数赋一个默认值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用 =  设置默认参数</span>
<span class="token keyword">function</span> <span class="token function">making</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> VIII</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">making</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//  King Louis VIII</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">making</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  King Henry VIII</span>
</code></pre></div><p>在使用默认参数时，<code>arguments</code>对象的值始终以传入的值为准。</p> <p><mark>默认参数值并不限于原始值或对象类型，也可以使用调用函数返回的值</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//将函数设置成默认参数</span>
<span class="token keyword">let</span> romanNumerals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'II'</span><span class="token punctuation">,</span> <span class="token string">'III'</span><span class="token punctuation">,</span> <span class="token string">'IV'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">,</span> <span class="token string">'VI'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ordinality <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getNumerals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 每次调用后递增</span>
    <span class="token keyword">return</span> romanNumerals<span class="token punctuation">[</span>ordinality<span class="token operator">++</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">making</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">,</span> numerals <span class="token operator">=</span> <span class="token function">getNumerals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>numerals<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">making</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 'King Henry I'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">making</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">,</span> <span class="token string">'XVI'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Louis XVI'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">making</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'King Henry II'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">making</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'King Henry III''King Henry III'</span>
</code></pre></div><h3 id="默认参数和作用域和暂时性死区"><a href="#默认参数和作用域和暂时性死区" class="header-anchor">#</a> 默认参数和作用域和暂时性死区</h3> <p><mark>参数初始化顺序遵循“暂时性死区”规则。前面定义的参数不能引用后面定义的，会抛错</mark></p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 调用时不传第一个参数汇报材料</span>
    <span class="token keyword">function</span> <span class="token function">making</span><span class="token punctuation">(</span>name <span class="token operator">=</span> numerals<span class="token punctuation">,</span> numerals <span class="token operator">=</span> <span class="token string">'VIII'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>numerals<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token function">making</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//  Cannot access 'numerals' before initialization</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">making</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">,</span> numerals <span class="token operator">=</span> defaultNumeral<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> defaultNumeral <span class="token operator">=</span> <span class="token string">'VII'</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>numerals<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6、参数扩展与收集-p295"><a href="#_6、参数扩展与收集-p295" class="header-anchor">#</a> 6、参数扩展与收集 p295</h2> <p><code>ECMAScript6</code>中新增了扩展操作符。其最有用的作用场景就是<strong>函数定义中的参数列表</strong></p> <p>扩展操作符既可以用于<strong>调用函数时传参</strong>，也可以用于<strong>定义函数参数</strong>。</p> <h3 id="_6-1、扩展参数"><a href="#_6-1、扩展参数" class="header-anchor">#</a> 6.1、扩展参数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 01,2,3,4</span>
<span class="token comment">// arguments [[1,2,3,4]]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
<span class="token comment">// arguments [1,2,3,4]</span>
</code></pre></div><p>通过<strong>可迭代对象</strong>的扩展操作符，可将<strong>迭代对象</strong>作为一个参数进行拆分，并将迭代返回的每个值单独传入。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">...</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10 </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9 </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">...</span>values<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15 </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span>values<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 14 </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">...</span>values<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 28 </span>
</code></pre></div><p>在普通函数和箭头函数中也可将扩展操作符用于命名参数，同时也能使用命名参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在普通函数和箭头函数中使用扩展操作符命令参数，同时可以设置默认参数</span>
<span class="token keyword">function</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        
  <span class="token keyword">return</span> a <span class="token operator">*</span> b <span class="token operator">*</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">getSum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//6</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><h3 id="_6-2、收集参数-p296"><a href="#_6-2、收集参数-p296" class="header-anchor">#</a> 6.2、收集参数 p296</h3> <p>扩展操作符能将<strong>不同长度</strong>的<strong>独立参数</strong>组合为<strong>同一个数组</strong>。有点类似<code>arguments</code>对象，但得到是一个<code>Array</code>实例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过扩展操作符将独立的参数整合为一个数组。</span>
<span class="token keyword">function</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>values</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 3]</span>
    <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> pre</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> total <span class="token operator">+</span> pre<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
</code></pre></div><p>收集参数的前面如果还有命令参数，则只会收集其余的参数；如果没有则会得到空数组。</p> <p><mark>因为收集参数是可变的，所以要将他作为作为最后一个参数</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 因为收集参数是可变的，所以将他作为最后一个参数</span>
<span class="token comment">// 不行</span>
<span class="token keyword">function</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>values<span class="token punctuation">,</span> lastValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 可行</span>
<span class="token keyword">function</span> <span class="token function">ignoreFirst</span><span class="token punctuation">(</span><span class="token parameter">firstValue<span class="token punctuation">,</span><span class="token operator">...</span>values</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">ignoreFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// []</span>
<span class="token function">ignoreFirst</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// []</span>
<span class="token function">ignoreFirst</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2]</span>
<span class="token function">ignoreFirst</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2, 3]</span>
</code></pre></div><p><mark>可以通过箭头函数实现与<code>arguments</code>一样的逻辑</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过收集参数实现与arguments相同的逻辑</span>
<span class="token keyword">let</span> <span class="token function-variable function">getSum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> pre</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> total <span class="token operator">+</span> pre<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
</code></pre></div><p>收集参数并不会影响到<code>arguments</code>对象，因为其仍然传入的是调用时传入的参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>values</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span>  <span class="token comment">// 3</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span> <span class="token comment">// [1,2,3]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// [1,2,3]</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h2 id="_7、函数声明与函数表达式-p-297"><a href="#_7、函数声明与函数表达式-p-297" class="header-anchor">#</a> 7、函数声明与函数表达式 p 297</h2> <p><strong>区别：</strong></p> <ul><li><p><code>JS</code>引擎在执行任何代码之前，会<strong>先读取</strong>函数声明，然后在执行上下文生成函数定义。这个过程被称为<strong>函数声明提升</strong></p></li> <li><p>函数表达式必须等到代码执行到那一行，才会在执行上下文中生成函数定义。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这是没问题的</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>
</code></pre></div><p>如果将函数声明改为等价的函数表达式，就会在执行时报错</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// sum is not defined</span>
<span class="token keyword">let</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum1</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// sum1 is not defined</span>
<span class="token keyword">var</span> <span class="token function-variable function">sum1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>
</code></pre></div><p>上述报错是因为，函数声明只能等到代码执行到这一行时，才会在执行上下文中生成函数定义。并且这并不是因为<code>let</code>所导致的，<code>var</code>也会出现同样的情况。</p> <div class="custom-block tip"><p class="title"></p><p>在使用函数表达式初始化变量时，也可以给函数一个名称，比如 let sum =
function sum() {}</p></div><h2 id="_8、函数作为值-p298"><a href="#_8、函数作为值-p298" class="header-anchor">#</a> 8、函数作为值 p298</h2> <p>为什么函数能够作为值进行传参？</p> <p>因为函数名在<code>ECMAScript</code>中就是变量，所以函数可以使用在任何使用变量的地方。</p> <p><mark>需要注意的是，在进行传参时，如果是要访问函数而不是调用函数，就必须不加括号。</mark></p> <p>怎样对一个数组对象进行排序？</p> <p>通过<code>sort()</code>方法，该方法接受两个需要比较的值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过 sort 方法进行数组对象中属性的排序</span>
<span class="token keyword">function</span> <span class="token function">createComparisonFunction</span><span class="token punctuation">(</span><span class="token parameter">propertyName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// sort 会在function中传入两个参数</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object1<span class="token punctuation">,</span> object2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> value1 <span class="token operator">=</span> object1<span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> value2 <span class="token operator">=</span> object2<span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>value1 <span class="token operator">&lt;</span> value2<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>value1 <span class="token operator">&gt;</span> value2<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span>  <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Zachary&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
data<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">createComparisonFunction</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_9、函数内部-p299"><a href="#_9、函数内部-p299" class="header-anchor">#</a> 9、函数内部 p299</h2> <p><mark>在<code>ECMAScript5</code>中，函数内部有两个特殊的对象，<code>arguments</code>和<code>this</code></mark></p> <p><mark><code>ECMAscript6</code>又新增了<code>new.target</code>属性</mark></p> <h3 id="_9-1、-arguments"><a href="#_9-1、-arguments" class="header-anchor">#</a> 9.1、 arguments</h3> <p><code>arguments</code>对象是什么？</p> <p>它是一个类数组对象，包含调用函数时传入的所有参数，并且只以<code>function</code>关键词定义函数时（相对于构造函数）才会存在。</p> <p><mark><code>arguments</code>对象有一个<code>callee</code>属性，是一个指向<code>arguments</code>对象所在函数的指针</mark></p> <p>下面举个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 经典的阶乘函数</span>
<span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>  num <span class="token operator">*</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num <span class="token operator">-</span> <span class="token number">1</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面这个列子必须保证函数名是<code>factorial</code>，从而导致紧密耦合。使用<code>arguments.callee</code>可以让函数逻辑和函数名解耦。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用 arguments.callee 进行解耦</span>
<span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> num <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token comment">// arguments.callee 是指向arguments对象所在函数的指针</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>callee<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  num <span class="token operator">*</span> arguments<span class="token punctuation">.</span><span class="token function">callee</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> trueFactorial <span class="token operator">=</span> factorial<span class="token punctuation">;</span>
<span class="token function-variable function">factorial</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">trueFactorial</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 120</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
</code></pre></div><p><code>trueFactorial</code>变量被赋值为 <code>factorial</code>，实际上把同一个函数的指针又保存到了另一个位置。同时<code>callee</code>指向的是其<code>arguments</code>对象所在函数的指针，所以无论怎么改变都是最初的函数。</p> <h3 id="_9-2、-this-p300"><a href="#_9-2、-this-p300" class="header-anchor">#</a> 9.2、 this p300</h3> <p><mark><code>this</code>在<strong>标准函数</strong>和<strong>箭头函数</strong>中存在着差异。</mark></p> <ul><li><p>标准函数中：</p> <p><code>this</code>引用的是把函数当成方法调用的上下文对象。通常称其为<code>this</code>值（在全局上下文中调用函数时，<code>this</code>指向<code>window</code>）</p> <p><code>this</code>引用哪个对象必须到函数被调用时才能确定，也可以理解为</p> <p><mark>谁调用了这个函数，<code>this</code>就指向谁。</mark></p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span> 
 <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'blue'</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">function</span> <span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'red' </span>
o<span class="token punctuation">.</span>sayColor <span class="token operator">=</span> sayColor<span class="token punctuation">;</span>  
<span class="token comment">// 此时将o 将 sayColor()函数当做方法调用 </span>
<span class="token comment">// 因此this引用的是 o</span>
o<span class="token punctuation">.</span><span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'blue'</span>
</code></pre></div></li> <li><p>箭头函数中：</p> <p><code>this</code>引用的是定义箭头函数的上下文。</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span> 
 <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'blue'</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> <span class="token function-variable function">sayColor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'red' </span>
o<span class="token punctuation">.</span>sayColor <span class="token operator">=</span> sayColor<span class="token punctuation">;</span> 
o<span class="token punctuation">.</span><span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'red' </span>
</code></pre></div></li></ul> <p>怎样在事件回调和定时回调是确保<code>this</code>的指向？</p> <p>将回调函数写成箭头函数就行了。<mark>因为箭头函数中的<code>this</code>会保留定义该函数时的上下文</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">King</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>royaltyName <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">;</span>
    <span class="token comment">// this 引用 King 的实例</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>royaltyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Queen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>royaltyNmae <span class="token operator">=</span> <span class="token string">'Elizabeth'</span><span class="token punctuation">;</span>
    <span class="token comment">// this 引用 window 对象</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>royaltyNmae<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">King</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Henry</span>
<span class="token keyword">new</span> <span class="token class-name">Queen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre></div><h3 id="_9-3、caller-p301"><a href="#_9-3、caller-p301" class="header-anchor">#</a> 9.3、caller p301</h3> <p><code>ES5</code>中给函数定义的一个属性<code>caller</code>，<mark>该属性引用的是调用当前函数的函数</mark>如果是全局作用域中调用的就是<code>null</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inner<span class="token punctuation">.</span>caller<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token comment">/*ƒ outer(){
    inner()
}*/</span>
</code></pre></div><p>可以通过<code>arguments.callee.cller</code>降低耦合度</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>caller<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-4、-new-target-p301"><a href="#_9-4、-new-target-p301" class="header-anchor">#</a> 9.4、 new.target p301</h3> <p><code>ES6</code>中新增了检测函数是否使用<code>new</code>关键词调用的<code>new.target</code>属性。如果正常使用就返回<code>undefined</code>;如果使用的是<code>new</code>关键词调用，则<code>new.target</code>将引用被调用的构造函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过 new.target 判断是否是构造函数</span>
<span class="token keyword">function</span> <span class="token function">King</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token string">'King must be instantiated using &quot;new&quot;'</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'King instantiated using &quot;new&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">King</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// King instantiated using &quot;new&quot;</span>
<span class="token function">King</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught King must be instantiated using &quot;new&quot;</span>
</code></pre></div><h2 id="_10、属性和方法-p-302"><a href="#_10、属性和方法-p-302" class="header-anchor">#</a> 10、属性和方法 p 302</h2> <p><code>ECMA</code>中的函数<strong>是对象</strong>，因此有<strong>属性和方法</strong>。每个函数都有两个属性<code>length</code>和<code>arguments</code>,<code>es6</code>中新增了只读属性<code>name</code></p> <p><code>length</code>：属性保存的是函数定义<strong>命名参数的个数</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sayName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1 <span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sayName<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sayHi<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
</code></pre></div><p><code>prototype</code>：是保存所有引用类型实例方法的地方。</p> <p>其特点：<code>toString()、valueOf()</code>实际上都保存在<code>prototype</code>上，进由所有实例方法<strong>共享</strong></p> <p>且<code>prototype</code>是不可被枚举的，因此<code>for-in</code>循环不会返回这个属性。</p> <p>函数中还有两个方法<code>apply()</code>和<code>call()</code>。都以指定的<code>this</code>调用函数。</p> <ul><li><p>即设置调用函数时函数体内<code>this</code>的值。</p></li> <li><p><code>apply</code>接收两个参数：函数内<code>this</code>值和一个参数数组。可以是<code>Array</code>实例，也可以是<code>arguments</code>对象</p></li> <li><p><code>call</code> 作用与<code>apply()</code> 一样：但是从第一个参数后面的参数起，都要逐个传入调用。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1 <span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">callSum1</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token comment">// 传入 arguments 对象</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">callSum2</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 传入数组</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">handleSum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">callSum1</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">callSum2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">handleSum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在这个例子中，<code>callSum1()</code>会调用 <code>sum()</code>函数，将 this 作为函数体内的 this 值（这里等于window，因为是在全局作用域中调用的）传入，同时还传入了 <code>arguments</code>对<code>callSum2()</code>也会调用<code>sum()</code>函数，但会传入参数的数组。</p> <div class="custom-block tip"><p class="title"></p><p>在严格模式下，调用函数时如果没有指定上下文对象，则 this 值不会指向 window。
除非使用 apply()或 call()把函数指定给一个对象，否则 this 的值会变成 undefined。</p></div><p><code>apply()和call()</code>主要作用<strong>不是传参</strong>，而是控制函数<strong>调用上下文即函数体内<code>this</code>值</strong>的能力。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过apply() 和 call() 控制函数上下文中 this 的值</span>
window<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">color</span> <span class="token operator">:</span> <span class="token string">'blue'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// red</span>
<span class="token function">sayColor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token comment">// red    this =&gt; window</span>
<span class="token function">sayColor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span> <span class="token comment">// red</span>
<span class="token function">sayColor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>  <span class="token comment">// blue // this =&gt; 将上下文切换到o</span>
</code></pre></div><p><code>ES5</code>中新增了<code>bind()</code>方法。该方法会创建一个新的实例函数。即<code>this</code>值会绑定到传给<code>bind()</code>的对象；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将 this 的值绑定传给 bind 对象</span>
window<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 将this的值绑定传给 bind 对象</span>
<span class="token keyword">let</span> objectSayColor <span class="token operator">=</span> <span class="token function">sayColor</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">objectSayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// blue</span>
</code></pre></div><div class="custom-block tip"><p class="title"></p><p>对函数而言，继承的方法<code>toLocaleString()和 toString()</code>始终返回<strong>函数的代码</strong>。返回代码的具体格式因浏览器而异。有的返回源代码，包含注释，而有的只返回代码的内部形式，会删除注释，甚至代码可能被解释器修改过。由于这些差异，因此不能在重要功能中依赖这些方法返回的值，而只应在调试中使用它们。</p> <p><mark>继承的方法 valueOf()返回函数本身</mark></p></div><h2 id="_11、函数表达式-p304"><a href="#_11、函数表达式-p304" class="header-anchor">#</a> 11、函数表达式 p304</h2> <p>定义函数有两种方式：</p> <ul><li><p>函数声明：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg0<span class="token punctuation">,</span> num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 函数体</span>
<span class="token punctuation">}</span>
</code></pre></div><p><mark>函数声明的关键就是<code>函数声明提升</code>。</mark>这种情况下，<code>js</code>引擎会先读取函数声明，然后执行代码。</p></li> <li><p>函数表达式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">functionName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg0<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 <span class="token comment">// 函数体 </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>匿名函数</strong>： <code>function</code>后面没有接标识符。（<strong>匿名函数也被称为兰姆达函数</strong>）。未赋值给其他变量的匿名函数的<code>name</code>属性是空字符串。</p></li></ul> <p><mark>理解函数声明和函数表达式之前的区别，关键是理解声明提升</mark></p> <h2 id="_12、递归"><a href="#_12、递归" class="header-anchor">#</a> 12、递归</h2> <p><strong>p307</strong></p> <p><strong>递归函数</strong> 通常是一个函数通过名称调用自己。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>  num <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><mark>通过<code>arguments.callee</code>可以确保通过什么变量都能调用这个函数不出问题</mark></p> <p><mark>编写递归函数时<code>arguments.callee</code>是引用当前函数的首选。</mark></p> <p><mark>需要注意的是在严格模式下，是不能访问该方法的。可以使用<strong>命名函数表达式</strong></mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 命名函数表达式  相当于给函数添加一个标识符</span>
<span class="token comment">// 只能在函数作用域中使用</span>
<span class="token keyword">const</span> factorial <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> num <span class="token operator">*</span> <span class="token function">f</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这里创建了一个命名函数表达式 f()，然后将它赋值给了变量 factorial。即使把函数赋值给另
一个变量，函数表达式的名称 f 也不变，因此递归调用不会有问题。这个模式在严格模式和非严格模式下都可以使用</p> <h2 id="_13、尾调用优化"><a href="#_13、尾调用优化" class="header-anchor">#</a> 13、尾调用优化</h2> <p>什么是尾调用？</p> <p>答：<mark>外部函数的返回值是一个内部函数的返回值</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 外部函数的返回值是内部函数的返回值即尾调用</span>
<span class="token keyword">function</span> <span class="token function">outerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 尾调用</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<code>ES6</code>新增了一套内存管理优化机制，让<code>JS</code>引擎在满足条件时可以重用栈帧</p> <table><thead><tr><th style="text-align:left;"><strong>优化之前</strong></th> <th><strong>优化之后</strong></th></tr></thead> <tbody><tr><td style="text-align:left;">执行到<code>outerFUnction</code>函数体、第一个栈帧被推到栈上</td> <td>执行到<code>outerFunction</code>函数体、第一个栈帧被推到栈上</td></tr> <tr><td style="text-align:left;">执行<code>outerFunction</code>函数体、到<code>return</code>语句，计算返回值必须先计算<code>innerFunction</code></td> <td>执行<code>outerFunction</code>函数体，到达<code>return</code>语句。计算返回值必须先求知<code>innerFunction</code>。</td></tr> <tr><td style="text-align:left;">执行到<code>innerFunction</code>函数体，第二个栈帧被推倒栈上。</td> <td>引擎发现可将第一个栈帧弹出，因为<code>innerFunction</code>的返回值也是<code>outerFunction</code>的返回值。</td></tr> <tr><td style="text-align:left;">执行<code>innerFunction</code>函数体，计算其返回值</td> <td>弹出<code>outerFunction</code>栈帧。</td></tr> <tr><td style="text-align:left;">将返回值传回<code>outerFunction</code>,然后<code>outerFuncion</code>再返回值</td> <td>执行到<code>innerFunction</code>函数体,栈帧被推到栈上。</td></tr> <tr><td style="text-align:left;">将栈帧弹出栈外</td> <td>执行<code>innerFuncion</code>函数体，计算其返回值。</td></tr> <tr><td style="text-align:left;"></td> <td>将<code>innerFunction</code>的栈帧弹出栈外。</td></tr></tbody></table> <p>区别：</p> <ul><li><p>优化之前：每多一调用一次嵌套函数，就会多增加一个栈帧。</p></li> <li><p>优化之后：无论调用多少次嵌套函数，都只有一个栈帧。这也是<code>ES6</code>尾调用优化的关键。</p></li></ul> <h3 id="_13-1、尾调用优化的条件"><a href="#_13-1、尾调用优化的条件" class="header-anchor">#</a> 13.1、尾调用优化的条件</h3> <p><strong>p307</strong></p> <p>尾调用优化的条件？</p> <p>答：确定外部帧真的没有必要存在了，具体条件如下：</p> <ul><li><p>代码在严格模式下执行；</p></li> <li><p>外部函数的返回值是对尾调用函数的调用；</p></li> <li><p>尾调用函数返回后不需要执行额外的逻辑；</p></li> <li><p>尾调用函数不是引用外部函数作用域中自有变量的闭包；</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 尾调用函数</span>
<span class="token keyword">function</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1111</span>
<span class="token punctuation">}</span>
<span class="token comment">// 无优化： 尾调没有返回</span>
<span class="token keyword">function</span> <span class="token function">outerFunction1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 无优化： 尾调没有直接返回</span>
<span class="token keyword">function</span> <span class="token function">outerFunction2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> innerFunctionResult <span class="token operator">=</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> innerFunctionResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 无优化： 尾调用返回后被转换为字符串</span>
<span class="token keyword">function</span> <span class="token function">outerFunction3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 无优化： 尾调用是一个闭包</span>
<span class="token keyword">function</span> <span class="token function">outerFunction4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">innerFunction1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> foo<span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">innerFunction1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><mark>符合尾调用条件的例子</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 符合尾调用函数优化的例子</span>
<span class="token string">&quot;use strict&quot;</span>
<span class="token keyword">function</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 有优化：栈帧销毁前执行参数计算</span>
<span class="token keyword">function</span> <span class="token function">outerFunction1</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 有优化： 初始返回值不设计栈帧</span>
<span class="token keyword">function</span> <span class="token function">outerFunction2</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&gt;</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> b
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span>  <span class="token function">innerFunction</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 有优化：两个内部函数都在尾部</span>
<span class="token keyword">function</span> <span class="token function">outerFunction3</span><span class="token punctuation">(</span><span class="token parameter">condition</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> condition <span class="token operator">?</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><mark>无论是<strong>递归尾调</strong>还是<strong>非递归尾调</strong>，<strong>都可优化</strong>。引擎<strong>不会区分调用的</strong>是<strong>自身函数</strong>还是<strong>其他函数</strong></mark></p> <p><strong>为什么要在严格模式下使用栈帧？</strong></p> <p>答：因为在非严格模式下函数调用是允许使用<code>f.arguments</code>和<code>f.caller</code>,而他们引用的都是外部函数的栈帧。这就意味着不能优化了。因此尾调用函数优化必须在严格模式下，就是为了防止使用这些属性</p> <h3 id="_13-2、尾调用优化代码"><a href="#_13-2、尾调用优化代码" class="header-anchor">#</a> 13.2、尾调用优化代码</h3> <p>p309</p> <p>将简单的递归函数转换为待优化的代码以此加深理解</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 普通的斐波那契数列函数 fib(n)的栈</span>
<span class="token comment">// 帧数的内存复杂度是 O(2n)</span>
<span class="token punctuation">)</span>。
<span class="token keyword">function</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> n
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span>  <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fib</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 进行尾调优化</span>
<span class="token string">'use strict'</span>
<span class="token comment">// 基础框架</span>
<span class="token keyword">function</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fibImpl</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 执行递归</span>
<span class="token keyword">function</span> <span class="token function">fibImpl</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> n
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span>  <span class="token function">fib</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token operator">+</span>b <span class="token punctuation">,</span>n <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_14、闭包"><a href="#_14、闭包" class="header-anchor">#</a> 14、闭包</h2> <p>p309</p> <p><strong>什么是闭包？</strong></p> <p>匿名函数经常被人<strong>误认为</strong>是<strong>闭包</strong>。</p> <p><mark>但是闭包指的是引用了另一个函数作用域中变量的函数，通常在嵌套函数中实现。</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createComparisonFunction</span><span class="token punctuation">(</span><span class="token parameter">propertyName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object1<span class="token punctuation">,</span> object2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> value1 <span class="token operator">=</span> object1<span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 引用外部函数变量</span>
        <span class="token keyword">let</span> value2 <span class="token operator">=</span> object2<span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 引用外部函数变量</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value1 <span class="token operator">&lt;</span> value2<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value1 <span class="token operator">&gt;</span> value2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span> 
 <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
</code></pre></div><div class="custom-block tip"><p class="title"></p><p>在调用一个函数时，会为这个函数调用创建一个执行上下文，并创建一个作用域链。然后用<code>arguments</code>和其他命名参数来初始化这个函数的活动对象。<strong>外部函数的活动对象是内部函数作用域上的第二个对象</strong>，这个作用域链一直向外串起了所有包含函数的活动对象，直到指向全局上下文才结束。</p></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter">value1<span class="token punctuation">,</span> value2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value1 <span class="token operator">&lt;</span> value2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value1 <span class="token operator">&gt;</span> value2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p><code>compare</code>是在全局上下文中调用的，第一次调用时会为<code>compare</code>创建一个包含<code>arguments、value1、value2</code>的活动对象，这个对象是其作用域链上的第一个对象。而全局上下文中的变量对象<code>compare、this、result</code>，则是其作用域链上的第二个对象。</p> <p><strong>什么是变量对象？以及什么是活动对象？</strong></p> <p>每个执行上下文中都<strong>包含</strong>一个其中<strong>变量</strong>的<strong>对象</strong>。</p> <p><mark><strong>全局上下文中</strong>的叫<strong>全局变量</strong>，<strong>它会始终在代码执行期间存在</strong>。</mark></p> <p><mark>局部上下文中的叫做<strong>活动变量</strong>，只在代码执行期间存在。</mark></p> <p>在定义<code>compare()</code>函数时，会为它创建一个作用域链，预装载全局变量对象，并保存在<code>[[Scope]]</code>中。在调用这个函数时，会创建相应的执行上下文，然后通过复制函数的<code>[[Scope]]</code>来创建作用域。接着将创建函数的活动对象（用作变量对象）并将其推入作用域链的前端。这个例子中意味着<code>conpare()</code>函数执行上下文的作用域链中有两个变量对象：局部的变量对象和全局的变量对象。</p> <p><strong>作用域链</strong>其实是一个包含指针的列表，每个指针都指向一个变量对象，但物理上并不包含相应的对象。</p> <p><img src="https://upload-images.jianshu.io/upload_images/10868925-f946c88726d95380.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p> <p>函数内部的代码在<strong>访问变量</strong>时，会使用给定的名称从<strong>作用域中查找</strong>变量。函数<strong>执行完毕</strong>后，局部活动对象就<strong>会被销毁</strong>，内存中只剩下全局变量。</p> <p>函数内部定义的函数会将包含（外部）函数的活动对象添加到自己的作用域中。因此，在<code>createComparisonFuction()</code>中，匿名函数的作用域中实际包含了<code>createComparisonFunction()</code>活动对象。</p> <p><img src="https://upload-images.jianshu.io/upload_images/10868925-ad5d2dc22e1d85c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p> <p><code>createComparisonFunction()</code>返回匿名函数后，它的作用域链被初始化为包含 <code>createComparisonFunction()</code>的活动对象和全局变量对象。这样，匿名函数就可以访问到 <code>createComparisonFunction()</code>可以访问的所有变量。另一个有意思的副作用就是，<code>createComparisonFunction()</code>的活动对象并不能在它执行完毕后销毁，因为匿名函数的作用域链中仍然有对它的引用。在 <code>createComparisonFunction()</code>执行完毕后，其执行上下文的作用域链会销毁，但它的活动对象仍然会保留在内存中，直到匿名函数被销毁后才会被销毁：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建比较函数</span>
<span class="token keyword">let</span> compareNames <span class="token operator">=</span> <span class="token function">createComprisonFunction</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调用函数</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">compareNames</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sans'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sn'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//  解除对函数的引用，释放内存</span>
<span class="token keyword">let</span> compareNames <span class="token operator">=</span> <span class="token keyword">null</span>
</code></pre></div><p>把<code>compareNames</code>设置为<code>null</code>会解除对函数的引用。从而让垃圾回收程序可以将内存释放。作用域也会被销毁，出全局作用域外都可以被销毁。</p> <div class="custom-block tip"><p class="title"></p><p><strong>注意</strong>  因为闭包会保留它们包含函数的作用域，所以比其他函数更占用内存。过度使用闭
包可能导致内存过度占用，因此建议仅在十分必要时使用。V8 等优化的 JavaScript 引擎会
努力回收被闭包困住的内存，不过我们还是建议在使用闭包时要谨慎</p></div><h3 id="_14-1、-this对象"><a href="#_14-1、-this对象" class="header-anchor">#</a> 14.1、 this对象</h3> <p>p312</p> <p>在闭包中使用<code>this</code>:</p> <ul><li><p>没有使用箭头函数进行定义，则<code>this</code>对象会在运行时绑定到执行上下文。</p></li> <li><p>全局函数中调用，<code>this</code>在非严格模式下等于<code>window</code>、严格模式下等于<code>undefined</code></p></li> <li><p>作为某个对象的方法调用：则<code>this</code>等于这个对象。</p></li> <li><p>匿名函数不会绑定到某个对象，意味着指向<code>window</code>,严格模式下指向<code>undefined</code></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>identity <span class="token operator">=</span> <span class="token string">'The Window'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">identity</span><span class="token operator">:</span> <span class="token string">'My Object'</span><span class="token punctuation">,</span>
    <span class="token function">getIdentityFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 闭包中 匿名函数返回的this不会绑定到某个对象</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>identity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getIdentityFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// The Window</span>
</code></pre></div><p>为什么匿名函数没有使用其<strong>包含作用域</strong>（<code>getIdentityFunc()</code>）的<code>this</code>对象呢？</p> <p>答：函数在每次调用时都会自动创建两个特殊变量<code>this和arguments</code>。内部函数永远不可能直接访问外部函数的这两个变量。但是能将<code>this</code>保存到闭包可以访问的另一个变量中就行了。</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>identity <span class="token operator">=</span> <span class="token string">'The Window'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">identity</span><span class="token operator">:</span> <span class="token string">'My Object'</span><span class="token punctuation">,</span>
    <span class="token function">getIdentityFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 将外部函数中的this 进行保存</span>
        <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> that<span class="token punctuation">.</span>identity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getIdentityFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// My Object</span>
</code></pre></div><div class="custom-block tip"><p class="title"></p><p>注意 <code>this</code>和<code>arguments</code>都是<strong>不能直接</strong>在内部函数中<strong>访问的</strong>。如果想访问包含作用域中
的 <code>arguments</code>对象，则同样需要将其引用先保存到闭包能访问的另一个变量中。</p></div><p>特殊情况下 <code>this</code>的指向会不同：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 特殊情况下 this的指向会不同</span>
window<span class="token punctuation">.</span>identity <span class="token operator">=</span> <span class="token string">'The Window'</span>
<span class="token keyword">let</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">identity</span> <span class="token operator">:</span> <span class="token string">'My Object'</span><span class="token punctuation">,</span>
    <span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>identity
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// My Object</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>getIdentity<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// My Object</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>getIdentity <span class="token operator">=</span> object<span class="token punctuation">.</span>getIdentity<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// The Window</span>
</code></pre></div><ul><li><p>第一行正常调用：因为<code>this.identity</code>就是<code>object.identity</code>。</p></li> <li><p>第二行：按照规范<code>object.identity</code>和<code>(object.identity)</code>是相等的，因此看起来加了括号后是对一个函数的引用，其实<code>this</code>值并没有改变</p></li> <li><p>第三行：先执行了赋值操作，然后调用赋值后的结果。<mark>因为赋值表达式的值是函数本身</mark>，<code>this</code>值不再与任何对象绑定</p></li></ul> <h3 id="_14-2、内存泄漏-p314"><a href="#_14-2、内存泄漏-p314" class="header-anchor">#</a> 14.2、内存泄漏 p314</h3> <p>在旧版本的<code>IE</code>中，将<code>HTML</code>元素保存在某个闭包的作用域中，相当于宣布该元素不能被销毁。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 旧版本ie 中 以下元素不会被销毁</span>
<span class="token keyword">function</span> <span class="token function">assignHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'someElement'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>匿名函数引用着<code>assignHandler()</code>的<strong>活动对象</strong>，阻止了对<code>element</code>的引用<strong>计数归零</strong>。只要这个匿名函数窜在，<code>element</code>的引用计数就至少等于1。也就是内存不会被回收。</p> <p>解决方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 解决闭包内存泄漏的方法</span>
<span class="token keyword">function</span> <span class="token function">assignHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'someElement'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        id <span class="token operator">=</span> el<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    el<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>  <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    el <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>闭包引用的是一个包含着<code>el.id</code>的变量<code>id</code>，从而消除了循环引用。</p> <p>即使闭包没有直接引用<code>el</code>，<strong>包含函数</strong>的<strong>活动对象</strong>上还是保存着对它的引用。因此。必须将<code>el</code>设置成<code>null</code>。这样解除了对这个<code>DOM</code>对象的引用，其引用计数也会减少，从而确保其内存可以适当的被回收。</p> <h2 id="_15、立即调用的函数表达式-iife"><a href="#_15、立即调用的函数表达式-iife" class="header-anchor">#</a> 15、立即调用的函数表达式 IIFE</h2> <p>什么是立即调用的函数表达式?</p> <p>是立即调用的匿名函数（IIFE  immediately Invoked Function Expression）。类似函数声明，但被包含自括号中，可以被解释为函数表达式。</p> <p>紧跟在第一组括号后面的第二组括号会立即调用前面的函数表达式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// IIFE</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 块级作用域</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>使用<code>IIFE</code>可以模拟块级作用域。即在一个函数表达式内部声明变量，然后立即调用这个函数。这样位于函数体作用域内的变量就像在块级作用域中一样。这是因为在<code>ES5</code>尚未支持块级作用域，所以使用此方法进行模拟。</p> <p>在<code>ECMAScript5.1</code>之前，为了防止变量定义外泄，<strong>IIFE</strong> 是非常有效的方法，这样也不会导致闭包相关的内存问题。</p> <p><strong>IIFE</strong> 不会出现闭包相关问题的原因：</p> <p><mark>因为其没有对匿名函数的引用，因此只要函数执行完毕，作用域链就会被销毁。</mark></p> <p><mark><strong>IIFE</strong> 还可以锁定参数值</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 达不到目的！</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> divs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    divs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述循环变量<code>i</code>不会被限制在<code>for</code>循环的块级作用域中，这是因为执行单击处理程序时，迭代变量的值是循环结束的最终值。而且这个变量存在于循环体外部，随时可以访问。</p> <p>可以通过<strong>IIFE</strong>执行一个函数表达式，传入每次循环的当前索引，从而'锁定'点击时应该显示的索引值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> divs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    divs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">frozenCounter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>frozenCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><mark>使用<code>let</code>会为每个循环创建队里的变量，从而让每个单击处理程序都能引用特定索引</mark></p> <h2 id="_16、私有变量"><a href="#_16、私有变量" class="header-anchor">#</a> 16、私有变量</h2> <p>严格来说<code>JS</code>中没有私有成员的概念，因为其所有对象都是公有的。不过有<strong>私有变量</strong>的概念。任何定义在函数或块中的变量，都能认为是私有的。</p> <p>私有变量包括：函数参数，局部变量，以及函数内部定义的其他函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 私有变量 包括 函数参数，局部参数 函数内部定义的其他函数</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> num1  <span class="token operator">+</span> num2<span class="token punctuation">;</span>
    <span class="token keyword">return</span> sum
<span class="token punctuation">}</span>
</code></pre></div><p>该函数有三个私有变量<code>num1、 num2、 sum</code>。基于闭包能够通过作用域链访问外部活动对象的特性，可以创建出访问私有变量的公共方法。</p> <p><strong>特权方法</strong>：是能够访问<strong>函数私有</strong>变量（即私有函数）的<strong>公共方法</strong>。</p> <p>在构造函数中创建特权方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在构造函数中创建特权方法</span>
<span class="token keyword">function</span> <span class="token function">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> privaterVariable <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">privaterFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">publicMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        privaterVariable <span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">privaterFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述特权方法，<strong>本质上是一个闭包</strong>，其有着能够通过作用域链访问构造函数中定义的所有变量和函数的能力。</p> <p>通过定义私有变量和特权方法，以隐藏不能直接被修改的数据。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过私有变量和特权方法 隐藏不能修改的数据</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> name
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">setName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        name <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'sans'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sans;</span>
person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'sn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sn;</span>
</code></pre></div><p>私有变量<code>name</code>对每个<code>Person</code>实例都是独一无二的。因为每次调用构造函数都会创建一套变量和方法。但这也是构造函数的缺点，不过可以通过<strong>静态私有变量</strong> 实现特权方法解决这个问题。</p> <h3 id="_16-1、静态私有变量"><a href="#_16-1、静态私有变量" class="header-anchor">#</a> 16.1、静态私有变量</h3> <p>p 317</p> <p><mark>特权方法也可以通过使用私有作用域定义私有变量和函数来实现</mark>。这个模式如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 私有变量和私有函数</span>
    <span class="token keyword">let</span> privateVariable <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>
    <span class="token comment">// 构造函数</span>
    <span class="token function-variable function">MyObject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 公有和特权方法</span>
    <span class="token class-name">MyObject</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">publicMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        privateVariable<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里声明 <code>MyObject</code>并没有使用任何关键字。因为不使用关键字声明的变量会创建在全局作用域中，所以 <code>MyObject</code> 变成了全局变量，可以在这个私有作用域外部被访问。注意在严格模式下给未声明的变量赋值会导致错误。</p> <p><mark>特权方法作为一个闭包，始终引用着包含它的作用域。</mark></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        name <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        name <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Nicholas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Nicholas' </span>
person1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'Matt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Matt' </span>
<span class="token keyword">let</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Michael'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Michael' </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Michael' </span>
</code></pre></div><p>像这样创建静态私有变量可以利用原型更好地重用代码，只是每个实例没有了自己的私有变量。最终，到底是把私有变量放在实例中，还是作为静态私有变量，都需要根据自己的需求来确定。</p> <div class="custom-block tip"><p class="title"></p><p>使用闭包和私有变量会导致作用域链变长，作用域链越长，则查找变量所需的时间
也越多</p></div><h3 id="_16-2、模块模式"><a href="#_16-2、模块模式" class="header-anchor">#</a> 16.2、模块模式</h3> <p>p 318</p> <p>什么是模块模式？</p> <p>答：模块模式是在一个单例对象上实现了隔离和封装。</p> <p>什么是单例对象？</p> <p>答：就是只有一个实例的对象。</p> <p>通常使用对象字面量创建单例对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 单例对象</span>
<span class="token keyword">let</span> singleton <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'value'</span><span class="token punctuation">,</span>
    <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 方法的代码</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>模块模式在单例对象上加以扩展，使其<strong>通过作用域链</strong>来关联私有变量和特权方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过作用域链关联特权方法和私有变量</span>
<span class="token keyword">let</span> <span class="token function-variable function">singleton</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 私有变量和私有函数</span>
    <span class="token keyword">let</span> privateVariable <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 特权/共有方法和属性</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">publicProperty</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function">publicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            privateVariable<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个对象字面量中只包含可以公开访问的属性和方法。因为其定义在匿名函数内部，所以他的所有公共方法都可以访问同一个作用域的私有变量和私有函数。</p> <p>单例对象要进行某种初始化，并且要访问私有变量时。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 单例对象进行初始化，并且要访问私有变量时</span>
<span class="token keyword">let</span> <span class="token function-variable function">app</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 私有变量和私有函数</span>
    <span class="token keyword">let</span> components <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    components<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BaseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 公共接口</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function">getComponentCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> components<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">registerComponent</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span>  component <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                components<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前一个方法返回注册组件的数量，后一个方法负责注册新组件。</p> <div class="custom-block tip"><p class="title"></p><p>单例模式作为一个模块，经过<strong>初始化</strong>可以包含某些<strong>私有的数据</strong>，而这些数据也能通<strong>暴露</strong>的<strong>公共方法</strong>进行<strong>访问</strong>。</p> <p>这种方法创建的<strong>每个单例对象</strong>都是<code>Object</code>实例，因为最终单例都是由一个对象字面量表示的。并且单例对象通常是可以<strong>全局访问</strong>的，而不是作为参数传给函数的，所以可以避免使用<code>instanceof</code>操作符确保参数是不是对象类型的需求。</p></div><h3 id="_16-3-模块增强模式"><a href="#_16-3-模块增强模式" class="header-anchor">#</a> 16.3 模块增强模式</h3> <p>p320</p> <p>模块模式可以再返回对象之前对其进行增强。</p> <p>适合单例对象需要时某个特定类型的实例，但又必须给它添加额外的属性和方法的场景。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">singleton</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 私有变量和私有函数</span>
    <span class="token keyword">let</span> privateVariable <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 创建对象</span>
    <span class="token keyword">let</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加特权/共有属性和方法</span>
    object<span class="token punctuation">.</span>publicProperty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    object<span class="token punctuation">.</span><span class="token function-variable function">publicMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        privateVariable<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回对象</span>
    <span class="token keyword">return</span> object
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">application</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 私有变量和私有函数</span>
    <span class="token keyword">let</span> components <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    components<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BaseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建局部变量保存实例</span>
    <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BaseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 公共接口</span>
    app<span class="token punctuation">.</span><span class="token function-variable function">getComponentCount</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> components<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function-variable function">registerComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> component <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            components<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回实例</span>
    <span class="token keyword">return</span> app<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>重写的 application 单例对象的例子中，首先定义了私有变量和私有函数，跟之前例子中
一样。主要区别在于这里创建了一个名为 app 的变量，其中保存了 BaseComponent 组件的实例。这是最终要变成 application 的那个对象的局部版本。在给这个局部变量 app 添加了能够访问私有变量的公共方法之后，匿名函数返回了这个对象。然后，这个对象被赋值给 application。</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">6/19/2021, 8:18:19 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/js/Function/" class="prev router-link-active">
            函数
          </a></span> <span class="next"><a href="/js/Promise/">
            /js/Promise/
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_1、箭头函数-p288" class="sidebar-link reco-side-_1、箭头函数-p288" data-v-cb1513f6>1、箭头函数 p288</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_2、函数名" class="sidebar-link reco-side-_2、函数名" data-v-cb1513f6>2、函数名</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_3、理解参数-p-290" class="sidebar-link reco-side-_3、理解参数-p-290" data-v-cb1513f6>3、理解参数 p 290</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#箭头函数中的参数" class="sidebar-link reco-side-箭头函数中的参数" data-v-cb1513f6>箭头函数中的参数</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_4、没有重载-p92" class="sidebar-link reco-side-_4、没有重载-p92" data-v-cb1513f6>4、没有重载 p92</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_5、默认参数值" class="sidebar-link reco-side-_5、默认参数值" data-v-cb1513f6>5、默认参数值</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#默认参数和作用域和暂时性死区" class="sidebar-link reco-side-默认参数和作用域和暂时性死区" data-v-cb1513f6>默认参数和作用域和暂时性死区</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_6、参数扩展与收集-p295" class="sidebar-link reco-side-_6、参数扩展与收集-p295" data-v-cb1513f6>6、参数扩展与收集 p295</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_6-1、扩展参数" class="sidebar-link reco-side-_6-1、扩展参数" data-v-cb1513f6>6.1、扩展参数</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_6-2、收集参数-p296" class="sidebar-link reco-side-_6-2、收集参数-p296" data-v-cb1513f6>6.2、收集参数 p296</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_7、函数声明与函数表达式-p-297" class="sidebar-link reco-side-_7、函数声明与函数表达式-p-297" data-v-cb1513f6>7、函数声明与函数表达式 p 297</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_8、函数作为值-p298" class="sidebar-link reco-side-_8、函数作为值-p298" data-v-cb1513f6>8、函数作为值 p298</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_9、函数内部-p299" class="sidebar-link reco-side-_9、函数内部-p299" data-v-cb1513f6>9、函数内部 p299</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_9-1、-arguments" class="sidebar-link reco-side-_9-1、-arguments" data-v-cb1513f6>9.1、 arguments</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_9-2、-this-p300" class="sidebar-link reco-side-_9-2、-this-p300" data-v-cb1513f6>9.2、 this p300</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_9-3、caller-p301" class="sidebar-link reco-side-_9-3、caller-p301" data-v-cb1513f6>9.3、caller p301</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_9-4、-new-target-p301" class="sidebar-link reco-side-_9-4、-new-target-p301" data-v-cb1513f6>9.4、 new.target p301</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_10、属性和方法-p-302" class="sidebar-link reco-side-_10、属性和方法-p-302" data-v-cb1513f6>10、属性和方法 p 302</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_11、函数表达式-p304" class="sidebar-link reco-side-_11、函数表达式-p304" data-v-cb1513f6>11、函数表达式 p304</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_12、递归" class="sidebar-link reco-side-_12、递归" data-v-cb1513f6>12、递归</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_13、尾调用优化" class="sidebar-link reco-side-_13、尾调用优化" data-v-cb1513f6>13、尾调用优化</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_13-1、尾调用优化的条件" class="sidebar-link reco-side-_13-1、尾调用优化的条件" data-v-cb1513f6>13.1、尾调用优化的条件</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_13-2、尾调用优化代码" class="sidebar-link reco-side-_13-2、尾调用优化代码" data-v-cb1513f6>13.2、尾调用优化代码</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_14、闭包" class="sidebar-link reco-side-_14、闭包" data-v-cb1513f6>14、闭包</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_14-1、-this对象" class="sidebar-link reco-side-_14-1、-this对象" data-v-cb1513f6>14.1、 this对象</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_14-2、内存泄漏-p314" class="sidebar-link reco-side-_14-2、内存泄漏-p314" data-v-cb1513f6>14.2、内存泄漏 p314</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_15、立即调用的函数表达式-iife" class="sidebar-link reco-side-_15、立即调用的函数表达式-iife" data-v-cb1513f6>15、立即调用的函数表达式 IIFE</a></li><li class="level-2" data-v-cb1513f6><a href="/js/Function/function.html#_16、私有变量" class="sidebar-link reco-side-_16、私有变量" data-v-cb1513f6>16、私有变量</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_16-1、静态私有变量" class="sidebar-link reco-side-_16-1、静态私有变量" data-v-cb1513f6>16.1、静态私有变量</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_16-2、模块模式" class="sidebar-link reco-side-_16-2、模块模式" data-v-cb1513f6>16.2、模块模式</a></li><li class="level-3" data-v-cb1513f6><a href="/js/Function/function.html#_16-3-模块增强模式" class="sidebar-link reco-side-_16-3-模块增强模式" data-v-cb1513f6>16.3 模块增强模式</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.c68e1700.js" defer></script><script src="/assets/js/3.957d5f92.js" defer></script><script src="/assets/js/1.1e92a90c.js" defer></script><script src="/assets/js/25.6e52175e.js" defer></script>
  </body>
</html>
